# Global Settings
client_max_body_size=10485760

error_pages {
    404=/errors/404.html
    500=/errors/500.html
}

# Server Block 1
server {
    host=127.0.0.1
    port=8080
    server_names=example.com,www.example.com

    root=/var/www/example.com
    default_index=index.html

    # Routes
    route / {
        methods=GET,POST
    }

    route /redirect {
        redirect=https://www.example.com/newpage
        status=301
    }

    route /static {
        root=/var/www/example.com/static
        directory_listing=off
    }

    route /uploads {
        directory_listing=on
        upload_directory=/var/www/example.com/uploads
    }

    route /cgi-bin {
        cgi=true
        cgi_extension=.php
        cgi_path=/usr/bin/php-cgi
        methods=GET,POST
    }
}

# Server Block 2
server {
    host=0.0.0.0
    port=8080
    # No server_names specified, acts as default for host:port

    root=/var/www/localhost
    default_index=index.html

    # Routes
    route / {
        methods=ALL
    }

    route /api {
        methods=GET,POST,PUT,DELETE
        proxy_pass=http://127.0.0.1:3000
    }

    route /old-page {
        redirect=/new-page
        status=301
    }

    route /new-page {
        root=/var/www/localhost/new
        directory_listing=on
    }

    route /scripts {
        cgi=true
        cgi_extension=.py
        cgi_path=/usr/bin/python3
        methods=GET,POST
    }
}
